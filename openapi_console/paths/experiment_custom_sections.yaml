experiment_custom_sections:
  get:
    summary: Experiment Custom Sections [LIST]
    description: "**Required Permissions**: `ExperimentCustomSection List` or `ExperimentCustomSection Admin`"
    parameters:
      - name: type
        in: query
        schema:
          type: string
          enum: [test]
          description: "Filter by experiment type"
          example: "test"
      - name: archived
        in: query
        schema:
          type: boolean
          description: "Include archived sections"
          example: false
      - name: sort
        in: query
        schema:
          type: string
          example: "title"
      - name: page
        in: query
        schema:
          type: integer
          example: 1
          default: 1
      - name: per_page
        in: query
        schema:
          type: integer
          example: 15
          default: 15
    tags:
      - Experiment Custom Sections
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: "#/components/schemas/ExperimentCustomSection"
                metadata:
                  type: object
                  properties:
                    count:
                      type: integer
                    page:
                      type: integer
                    page_count:
                      type: integer
                    per_page:
                      type: integer
                    total:
                      type: integer
              required:
                - items
                - metadata
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
    operationId: listexperimentCustomSections
  post:
    summary: Experiment Custom Sections [CREATE]
    description: "**Required Permissions**: `ExperimentCustomSection Create` or `ExperimentCustomSection Admin`"
    tags:
      - Experiment Custom Sections
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                description: "Title of the custom section"
                example: "Deployment Plan"
              description:
                type: string
                description: "Description of the custom section"
                example: "Deployment plans for the experiment"
              type:
                type: string
                enum: [test]
                description: "Experiment type"
                example: "test"
            required:
              - title
              - description
              - type
    responses:
      "201":
        description: Created
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExperimentCustomSection"
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
    operationId: createexperimentCustomSections
experiment_custom_sections_by_id:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
        description: "Unique identifier for the experiment custom section"
  get:
    summary: Experiment Custom Sections [GET]
    description: "**Required Permissions**: `ExperimentCustomSection List` or `ExperimentCustomSection Admin`"
    tags:
      - Experiment Custom Sections
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExperimentCustomSection"
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
      "404":
        description: Not Found
    operationId: getexperimentCustomSections
  put:
    summary: Experiment Custom Sections [UPDATE]
    description: |
      **Required Permissions**: `ExperimentCustomSection Update` or `ExperimentCustomSection Admin`

      :::caution
      Only fields provided in the request will be updated. Fields not included in the request body will retain their existing values.

      Note that when updating experiment fields within custom sections (e.g., through the Experiments endpoint), all existing custom section field values will be DELETED and replaced with only those provided in the request.
      :::
    tags:
      - Experiment Custom Sections
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              title:
                type: string
                description: "Title of the custom section"
                example: "Deployment Plan"
              description:
                type: string
                description: "Description of the custom section"
                example: "Deployment plans for the experiment"
              type:
                type: string
                enum: [test]
                description: "Experiment type"
                example: "test"
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExperimentCustomSection"
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
      "404":
        description: Not Found
    operationId: updateexperimentCustomSections
  delete:
    summary: Experiment Custom Sections [ARCHIVE]
    description: "**Required Permissions**: `ExperimentCustomSection Archive` or `ExperimentCustomSection Admin`"
    tags:
      - Experiment Custom Sections
    responses:
      "204":
        description: No Content
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
      "404":
        description: Not Found
    operationId: deleteexperimentCustomSections
experiment_custom_sections_order:
  put:
    summary: Experiment Custom Sections [REORDER]
    description: "**Required Permissions**: `ExperimentCustomSection Update` or `ExperimentCustomSection Admin`"
    tags:
      - Experiment Custom Sections
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              experiment_custom_sections:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: integer
                      description: "ID of the custom section"
                      example: 1
                    order_index:
                      type: integer
                      description: "New order index"
                      example: 1
                    experiment_custom_section_fields:
                      type: array
                      items:
                        type: object
                        properties:
                          id:
                            type: integer
                            description: "ID of the custom section field"
                            example: 1
                          order_index:
                            type: integer
                            description: "New order index"
                            example: 1
                required:
                  - experiment_custom_sections
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                ok:
                  type: boolean
                  description: "Indicates if the operation was successful"
                experiment_custom_sections:
                  type: array
                  items:
                    $ref: "#/components/schemas/ExperimentCustomSection"
                experiment_custom_section_fields:
                  type: array
                  items:
                    $ref: "#/components/schemas/ExperimentCustomSectionField"
                errors:
                  type: array
                  items:
                    type: string
              required:
                - ok
      '400':
        description: Bad Request
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
    operationId: reorderExperimentCustomSections
experiment_custom_section_fields:
  get:
    summary: Experiment Custom Section Fields [LIST]
    description: '**Required Permissions**: `ExperimentCustomSection List` or `ExperimentCustomSection Admin`'
    tags:
      - Experiment Custom Section Fields
    parameters:
      - name: sort
        in: query
        schema:
          type: string
          example: title
      - name: page
        in: query
        schema:
          type: integer
          example: 1
          default: 1
      - name: per_page
        in: query
        schema:
          type: integer
          example: 15
          default: 15
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExperimentCustomSectionField'
                metadata:
                  type: object
                  properties:
                    count:
                      type: integer
                    page:
                      type: integer
                    page_count:
                      type: integer
                    per_page:
                      type: integer
                    total:
                      type: integer
              required:
                - items
                - metadata
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
    operationId: listexperimentCustomSectionFields
  post:
    summary: Experiment Custom Section Fields [CREATE]
    description: '**Required Permissions**: `ExperimentCustomSection Create` or `ExperimentCustomSection Admin`'
    tags:
      - Experiment Custom Section Fields
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                description: Name of the field
                example: rollback_plan
              title:
                type: string
                description: Display title of the field
                example: Rollback Plan
              description:
                type: string
                description: Description of the field
                example: Describe how to rollback in case of issues
              type:
                type: string
                enum:
                  - text
                  - string
                  - json
                  - boolean
                  - number
                description: Data type of the field
                example: text
              required:
                type: boolean
                description: Whether the field is required
                example: true
              section_id:
                type: integer
                description: ID of the parent section
                example: 1
            required:
              - name
              - title
              - description
              - type
              - required
              - section_id
    responses:
      '201':
        description: Created
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExperimentCustomSectionField'
      '400':
        description: Bad Request
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
    operationId: createexperimentCustomSectionFields
experiment_custom_section_fields_by_id:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
        description: Unique identifier for the experiment custom section field
  get:
    summary: Experiment Custom Section Fields [GET]
    description: '**Required Permissions**: `ExperimentCustomSection List` or `ExperimentCustomSection Admin`'
    tags:
      - Experiment Custom Section Fields
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExperimentCustomSectionField'
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
      '404':
        description: Not Found
    operationId: getexperimentCustomSectionFields
  put:
    summary: Experiment Custom Section Fields [UPDATE]
    description: |
      **Required Permissions**: `ExperimentCustomSection Update` or `ExperimentCustomSection Admin`

      :::caution
      Regular fields provided in the request will be updated. Regular fields not included in the request body will retain their existing values.

      However, when updating experiment custom section field values through the Experiments endpoint, ALL existing field values will be DELETED and replaced with only those provided in the request.
      :::
    tags:
      - Experiment Custom Section Fields
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              name:
                type: string
                description: Name of the field
                example: rollback_plan
              title:
                type: string
                description: Display title of the field
                example: Rollback Plan
              description:
                type: string
                description: Description of the field
                example: Describe how to rollback in case of issues
              type:
                type: string
                enum:
                  - text
                  - string
                  - json
                  - boolean
                  - number
                description: Data type of the field
                example: text
              required:
                type: boolean
                description: Whether the field is required
                example: true
              section_id:
                type: integer
                description: ID of the parent section
                example: 1
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExperimentCustomSectionField'
      '400':
        description: Bad Request
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
      '404':
        description: Not Found
    operationId: updateexperimentCustomSectionFields
  delete:
    summary: Experiment Custom Section Fields [ARCHIVE]
    description: '**Required Permissions**: `ExperimentCustomSection Archive` or `ExperimentCustomSection Admin`'
    tags:
      - Experiment Custom Section Fields
    responses:
      '204':
        description: No Content
      '401':
        description: Unauthorized
      '403':
        description: Forbidden
      '404':
        description: Not Found
    operationId: deleteexperimentCustomSectionFields
components:
  schemas:
    ExperimentCustomSection:
      type: object
      description: "Custom section for experiment forms"
      properties:
        id:
          type: integer
          description: "Unique identifier for the custom section"
          example: 1
        title:
          type: string
          description: "Title of the custom section"
          example: "Deployment Plan"
        description:
          type: string
          description: "Description of the custom section"
          example: "Deployment plans for the experiment"
        order_index:
          type: integer
          description: "Order position of the section"
          example: 1
        type:
          type: string
          enum: [test]
          description: "Experiment type"
          example: "test"
        archived:
          type: boolean
          description: "Whether the section is archived"
          example: false
        created_at:
          type: string
          format: date-time
          description: "Timestamp when the section was created"
        created_by_user_id:
          type: integer
          description: "ID of the user who created the section"
        updated_at:
          type: string
          format: date-time
          description: "Timestamp when the section was last updated"
        updated_by_user_id:
          type: integer
          description: "ID of the user who last updated the section"
        custom_section_fields:
          type: array
          items:
            $ref: "#/components/schemas/ExperimentCustomSectionField"
          description: "Fields in this custom section"
      required:
        - id
        - title
        - description
        - order_index
        - type
        - archived
        - created_at
        - created_by_user_id

    ExperimentCustomSectionField:
      type: object
      description: "Field in a custom section for experiment forms"
      properties:
        id:
          type: integer
          description: "Unique identifier for the field"
          example: 1
        name:
          type: string
          description: "Name of the field"
          example: "rollback_plan"
        title:
          type: string
          description: "Display title of the field"
          example: "Rollback Plan"
        description:
          type: string
          description: "Description of the field"
          example: "Describe how to rollback in case of issues"
        type:
          type: string
          enum: [text, string, json, boolean, number]
          description: "Data type of the field"
          example: "text"
        required:
          type: boolean
          description: "Whether the field is required"
          example: true
        order_index:
          type: integer
          description: "Order position of the field"
          example: 1
        section_id:
          type: integer
          description: "ID of the parent section"
          example: 1
        archived:
          type: boolean
          description: "Whether the field is archived"
          example: false
        created_at:
          type: string
          format: date-time
          description: "Timestamp when the field was created"
        created_by_user_id:
          type: integer
          description: "ID of the user who created the field"
        updated_at:
          type: string
          format: date-time
          description: "Timestamp when the field was last updated"
        updated_by_user_id:
          type: integer
          description: "ID of the user who last updated the field"
      required:
        - id
        - name
        - title
        - description
        - type
        - required
        - order_index
        - section_id
        - archived
        - created_at
        - created_by_user_id
