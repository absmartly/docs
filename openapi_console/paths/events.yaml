events:
  post:
    summary: Events [LIST]
    description: "**Required Permissions**: `List`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              filters:
                type: object
                properties:
                  from:
                    type: integer
                    description: "Start timestamp in milliseconds"
                    example: 1646715275000
                  to:
                    type: integer
                    description: "End timestamp in milliseconds"
                    example: 1647320075000
                  effective_exposures:
                    type: boolean
                    description: "Whether to include only effective exposures"
                    example: true
                  applications:
                    type: array
                    description: "Filter by application IDs"
                    items:
                      type: integer
                    example: [1, 2]
                  unit_types:
                    type: array
                    description: "Filter by unit type IDs"
                    items:
                      type: integer
                    example: [1]
                  event_types:
                    type: array
                    description: "Filter by event types"
                    items:
                      type: string
                    example: ["exposure", "goal"]
                  unit_uids:
                    type: array
                    description: "Filter by unit UIDs"
                    items:
                      type: string
                    example: ["user123", "user456"]
                  environment_types:
                    type: array
                    description: "Filter by environment types"
                    items:
                      type: string
                    example: ["production", "staging"]
                  event_names:
                    type: array
                    description: "Filter by event names"
                    items:
                      type: string
                    example: ["click", "purchase"]
              unit_hex:
                type: boolean
                description: "Whether to return unit IDs as hex"
                example: true
              take:
                type: integer
                description: "Number of events to return"
                example: 100
              skip:
                type: integer
                description: "Number of events to skip"
                example: 0
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                events:
                  type: array
                  items:
                    $ref: "#/components/schemas/Event"
                metadata:
                  type: object
                  properties:
                    total:
                      type: integer
                    count:
                      type: integer
              required:
                - events
                - metadata
      "401":
        description: Unauthorized
      "403":
        description: Forbidden

events_history:
  post:
    summary: Events History [LIST]
    description: "**Required Permissions**: `List`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              filters:
                type: object
                properties:
                  from:
                    type: integer
                    description: "Start timestamp in milliseconds"
                    example: 1646715275000
                  to:
                    type: integer
                    description: "End timestamp in milliseconds"
                    example: 1647320075000
                  effective_exposures:
                    type: boolean
                    description: "Whether to include only effective exposures"
                    example: true
                  applications:
                    type: array
                    description: "Filter by application IDs"
                    items:
                      type: integer
                    example: [1, 2]
                  unit_types:
                    type: array
                    description: "Filter by unit type IDs"
                    items:
                      type: integer
                    example: [1]
                  event_types:
                    type: array
                    description: "Filter by event types"
                    items:
                      type: string
                    example: ["exposure", "goal"]
                  unit_uids:
                    type: array
                    description: "Filter by unit UIDs"
                    items:
                      type: string
                    example: ["user123", "user456"]
                  environment_types:
                    type: array
                    description: "Filter by environment types"
                    items:
                      type: string
                    example: ["production", "staging"]
                  event_names:
                    type: array
                    description: "Filter by event names"
                    items:
                      type: string
                    example: ["click", "purchase"]
              period:
                type: string
                description: "Time period for the history intervals"
                example: "day"
              tz_offset:
                type: integer
                description: "Timezone offset in minutes"
                example: 0
              skip:
                type: integer
                description: "Number of periods to skip"
                example: 0
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                history:
                  type: array
                  items:
                    type: object
                    properties:
                      time:
                        type: integer
                        description: "Timestamp for the period"
                      count:
                        type: integer
                        description: "Number of events in the period"
                metadata:
                  type: object
                  properties:
                    total:
                      type: integer
                    count:
                      type: integer
              required:
                - history
                - metadata
      "401":
        description: Unauthorized
      "403":
        description: Forbidden

events_unit_data:
  post:
    summary: Get Unit Data
    description: "**Required Permissions**: `List`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              units:
                type: array
                description: "List of units to get data for"
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      description: "Unit type name"
                      example: "user"
                    uid:
                      type: string
                      description: "Unit ID"
                      example: "user123"
                required:
                  - type
                  - uid
            required:
              - units
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                units:
                  type: array
                  items:
                    $ref: "#/components/schemas/UnitData"
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
  delete:
    summary: Delete Unit Data
    description: "**Required Permissions**: `Delete`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              units:
                type: array
                description: "List of units to delete data for"
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      description: "Unit type name"
                      example: "user"
                    uid:
                      type: string
                      description: "Unit ID"
                      example: "user123"
                required:
                  - type
                  - uid
            required:
              - units
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                  example: true
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden

events_json_values:
  post:
    summary: Get JSON Values from Events
    description: "**Required Permissions**: `GetJsonData`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              event_type:
                type: string
                description: "Type of event to query"
                enum: ["exposure", "goal"]
                example: "exposure"
              path:
                type: string
                description: "JSON path to extract"
                example: "$.properties.browser"
              from:
                type: integer
                description: "Start timestamp in milliseconds"
                example: 1646715275000
              to:
                type: integer
                description: "End timestamp in milliseconds"
                example: 1647320075000
              experiment_id:
                type: integer
                description: "Filter by experiment ID (for exposure events)"
                example: 1
              goal_id:
                type: integer
                description: "Filter by goal ID (for goal events)"
                example: 1
            required:
              - event_type
              - path
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                values:
                  type: array
                  items:
                    type: object
                    properties:
                      value:
                        type: object
                        description: "Extracted JSON value"
                      count:
                        type: integer
                        description: "Frequency of this value"
                metadata:
                  type: object
                  properties:
                    total:
                      type: integer
                    count:
                      type: integer
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden
      "404":
        description: Not Found

events_json_layouts:
  post:
    summary: Get JSON Layouts
    description: "**Required Permissions**: `GetJsonData`"
    tags:
      - Events
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              source:
                type: string
                description: "Source of JSON data"
                enum: ["unit_attribute", "unit_goal_property"]
                example: "unit_attribute"
              phase:
                type: string
                description: "Processing phase"
                enum: ["before_enrichment", "after_enrichment"]
                example: "after_enrichment"
              prefix:
                type: string
                description: "JSON path prefix"
                example: ""
              source_id:
                type: integer
                description: "Source ID (goal ID, etc.)"
                example: 1
              from:
                type: integer
                description: "Start timestamp in milliseconds"
                example: 1646715275000
              to:
                type: integer
                description: "End timestamp in milliseconds"
                example: 1647320075000
            required:
              - source
              - phase
    responses:
      "200":
        description: OK
        content:
          application/json:
            schema:
              type: object
              properties:
                layouts:
                  type: array
                  items:
                    type: object
                    properties:
                      path:
                        type: string
                        description: "JSON path"
                      type:
                        type: string
                        description: "Value type"
                      count:
                        type: integer
                        description: "Frequency of this path"
                metadata:
                  type: object
                  properties:
                    total:
                      type: integer
                    count:
                      type: integer
      "400":
        description: Bad Request
      "401":
        description: Unauthorized
      "403":
        description: Forbidden

# Components
components:
  schemas:
    Event:
      type: object
      description: "Represents an event in the system"
      properties:
        id:
          type: string
          description: "Event ID"
          example: "1234567890abcdef"
        timestamp:
          type: integer
          description: "When the event occurred (milliseconds since epoch)"
          example: 1646715275000
        type:
          type: string
          description: "Event type"
          enum: ["exposure", "goal"]
          example: "exposure"
        name:
          type: string
          description: "Event name"
          example: "purchase"
        unit_type:
          type: string
          description: "Unit type name"
          example: "user"
        unit_uid:
          type: string
          description: "Unit ID"
          example: "user123"
        properties:
          type: object
          description: "Event properties"
          example: { "amount": 99.99, "product_id": "p123" }
        metadata:
          type: object
          description: "Event metadata"
          example: { "browser": "Chrome", "device": "mobile" }
    UnitData:
      type: object
      description: "Data associated with a unit"
      properties:
        unit_type:
          type: string
          description: "Unit type name"
          example: "user"
        unit_uid:
          type: string
          description: "Unit ID"
          example: "user123"
        attributes:
          type: object
          description: "Unit attributes"
          example: { "country": "US", "age": 30 }
        exposures:
          type: array
          description: "Experiment exposures for this unit"
          items:
            type: object
            properties:
              experiment_id:
                type: integer
                description: "Experiment ID"
                example: 1
              variant_id:
                type: integer
                description: "Variant ID"
                example: 2
              timestamp:
                type: integer
                description: "When the exposure occurred"
                example: 1646715275000
        goals:
          type: array
          description: "Goal completions for this unit"
          items:
            type: object
            properties:
              goal_id:
                type: integer
                description: "Goal ID"
                example: 1
              value:
                type: number
                description: "Goal value"
                example: 99.99
              timestamp:
                type: integer
                description: "When the goal was achieved"
                example: 1646715275000
