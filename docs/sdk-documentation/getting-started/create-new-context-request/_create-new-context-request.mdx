import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import CodeBlock from "@theme/CodeBlock";

import JsRawPromises from "!!raw-loader!./js/usingRawPromises.js";
import JsAsyncAwait from "!!raw-loader!./js/usingAsyncAwait.js";
import JsPreFetchedData from "!!raw-loader!./js/withPreFetchedData.html";

import SwiftNewContext from "!!raw-loader!./swift/newContext.swift";
import SwiftPreFetchedData from "!!raw-loader!./swift/withPreFetchedData.swift";
import SwiftSetExtraUnits from "!!raw-loader!./swift/settingExtraUnits.swift";

import VuePreFetchedData from "!!raw-loader!./vue/initializeWithPrefetchedData.js";

import JavaSync from "!!raw-loader!./java/sync.java";
import JavaAsync from "!!raw-loader!./java/async.java";
import JavaPreFetched from "!!raw-loader!./java/preFetchedData.java";
import JavaExtraUnits from "!!raw-loader!./java/extraUnits.java";

In order to start linking your experiments from the web console to your
application, you will need to create a context. When you instantiate a context,
you should pass all known characteristics of the current user. These
characteristics are known as "units".

You can use anything as a unit. For example, you can pass an internal user id or
email address. You could also pass a `device_id` that you store in a first-
party cookie or a mobile application `UUID`.

:::info Keep In Mind
The units that you pass must first be declared on your A/B Smartly Web Console.
:::

:::caution
Experiments that are tracked by a unit which is not passed here will be turned
off in this request and the control treatment will be shown instead.
:::

<Tabs groupId="language">

<TabItem value="js" label="Javascript">

**Create A New Context With Raw Promises**

<CodeBlock language="js">{JsRawPromises}</CodeBlock>

**Create A New Context With Async/Await**

<CodeBlock language="js">{JsAsyncAwait}</CodeBlock>

**Create A New Context With Pre-Fetched Data**

When doing full-stack experimentation with A/B Smartly, we recommend only creating a
context once on the server-side. Creating a context involves a round-trip
to the A/B Smartly event collector. We can avoid repeating the round-trip on
the client-side by sending the server-side data embedded in the first document,
for example, by rendering it on the template. We can then initialize the
A/B Smartly context on the client-side directly with it.

<CodeBlock language="html">{JsPreFetchedData}</CodeBlock>

</TabItem>

<TabItem value="swift" label="Swift">

**Creating a New Context**

<CodeBlock language="swift">{SwiftNewContext}</CodeBlock>

**Creating a New Context With Pre-Fetched Data**

When doing full-stack experimentation with A/B Smartly, we recommend creating a
context only once on the server-side. Creating a context involves a round-trip
to the A/B Smartly event collector. We can avoid repeating the round-trip on
the client-side by sending the server-side data embedded with other application
data. We can then initialize the A/B Smartly context directly with it.

<CodeBlock language="swift">{SwiftPreFetchedData}</CodeBlock>

**Setting Extra Units**

You can add additional units to a context by calling the `setUnit()` or
`setUnits()` methods. These methods may be used, for example, when a user logs in
to your application and you want to use the new unit type in the context.

:::caution Please Note
You cannot override an already set unit type as that would be a change of
identity, and would crash your application. In this case, you must create a new
context instead. The `setUnit()` and `setUnits()` methods can be called before
the context is ready.
:::

<CodeBlock language="swift">{SwiftSetExtraUnits}</CodeBlock>

</TabItem>

<TabItem value="vue" label="Vue2">

**Initializing with pre-fetched Context data**

When doing full-stack experimentation with A/B Smartly, we recommend creating
a context only once on the server-side. Creating a context involves a
round-trip to the A/B Smartly event collector. We can avoid repeating the
round-trip on the client-side by sending the server-side data embedded in the
first document, for example, by rendering it on the template. Then we can
initialize the A/B Smartly context on the client-side directly with it. The
Vue2 SDK also supports this optimized usage.

In this example, we assume the variable `prefectedContextData` contains the
pre-fetched data previously injected.

<CodeBlock language="js">{VuePreFetchedData}</CodeBlock>

</TabItem>

<TabItem value="java" label="Java">

**Create A New Context Synchronously**

<CodeBlock language="java">{JavaSync}</CodeBlock>

**Create A New Context Asynchronously**

<CodeBlock language="java">{JavaAsync}</CodeBlock>

**Create A New Context With Pre-Fetched Data**

Creating a context involves a round-trip to the A/B Smartly event collector.
We can avoid repeating the round-trip on the client-side by re-using data
previously retrieved.

<CodeBlock language="java">{JavaPreFetched}</CodeBlock>

**Setting Extra Units**

You can add additional units to a context by calling the `setUnit()` or
`setUnits()` methods. These methods may be used, for example, when a user logs in
to your application and you want to use the new unit type in the context.

:::caution Please Note
You cannot override an already set unit type as that would be a change of
identity and would throw an exception. In this case, you must create a new
context instead. The `setUnit()` and `setUnits()` methods can be called before
the context is ready.
:::

<CodeBlock language="java">{JavaExtraUnits}</CodeBlock>

</TabItem>

</Tabs>
