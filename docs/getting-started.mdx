---
sidebar_position: 1
sidebar_title: Getting Started
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Getting Started

This guide provides detailed information about A/B Smartly’s JavaScript SDK.

---

## Install the SDK in your project.

<Tabs groupId="language">

<TabItem value="js" label="Javascript">

**NPM**

```bash
npm install --save @absmartly/javascript-sdk
```

or

**Direct Import**

```html
<script src="<YOUR-HOSTNAME>/absmartly.min.js"></script>
```

:::caution

A/B Smartly’s Javascript SDK depends on support for a native ES6 promise
implementation. If your environment does not support ES6 promises, you
can <a href="https://github.com/stefanpenner/es6-promise">polyfill</a>.

:::

</TabItem>

<TabItem value="ruby" label="Ruby">

```bash
bundle add absmartly

# Or if not using Bundle

gem install absmartly
```

</TabItem>

<TabItem value="swift" label="Swift">

**Swift Package Manager**

1. In Xcode go to: `File -> Swift Packages -> Add Package Dependency...`
2. Enter the A/B Smartly Swift SDK GitHub repository: https://github.com/absmartly/swift-sdk
3. Select the SDK version (latest recommended)
4. Select the ABSmartly library

**Cocoapods**

To install the A/B Smartly SDK with CocoaPods, add the following lines to your `Podfile`:

```ruby
pod 'ABSmartlySwiftSDK', '~> 1.0.2'
```

Run the following command to update your Xcode project:

```bash
pod install
```

</TabItem>

<TabItem value="vue" label="Vue2">

**Using NPM**

```bash
npm install --save @absmartly/vue2-sdk
```

**Directly Import With <a href="https://unpkg.com" target="_blank">unpkg.com</a>
(Optimized and Pre-Built)**

Simply add the following code to your `head` section to include the latest published version.

```html
<script src="https://unpkg.com/@absmartly/vue2-sdk"></script>
```

</TabItem>

<TabItem value="java" label="Java">

**Gradle**

To install the ABSmartly SDK, place the following in your `build.gradle` and
replace \{VERSION\} with the latest SDK version available in MavenCentral.

```gradle
dependencies {
  compile 'com.absmartly.sdk:core-api:{VERSION}'
}
```

**Maven**

To install the ABSmartly SDK, place the following in your `pom.xml` and
replace \{VERSION\} with the latest SDK version available in MavenCentral.

```xml
<dependency>
  <groupId>com.absmartly.sdk</groupId>
  <artifactId>core-api</artifactId>
  <version>{VERSION}</version>
</dependency>
```

:::caution Android 6.0 or earlier

When targeting Android 6.0 or earlier, the default Java Security
Provider will not work.
Using <a href="https://github.com/google/conscrypt" target="_blank">Conscrypt</a>
is recommended.
Follow <a href="https://github.com/google/conscrypt/blob/master/README.md" target="_blank">these instructions</a>
to install it as dependency.
:::

</TabItem>

</Tabs>

## Import and Initialize the SDK

<Tabs groupId="language">

<TabItem value="js" label="Javascript">

```js
// ES6 Modules
import absmartly from "@absmartly/javascript-sdk";

// For commonJS, use:
// const absmartly = require("@absmartly/javascript-sdk");

const sdk = new absmartly.SDK({
  endpoint: "https://sandbox-api.absmartly.com/v1",
  apiKey: process.env.ABSMARTLY_API_KEY,
  environment: process.env.NODE_ENV,
  application: process.env.APPLICATION_NAME,
});
```

</TabItem>

<TabItem value="ruby" label="Ruby">

:::info
Sorry, our Ruby documentation is not yet complete.
:::

</TabItem>

<TabItem value="swift" label="Swift">

```swift
import ABSmartly

let sdk: ABSmartlySDK
do {
    let clientConfig = ClientConfig(
        apiKey: ProcessInfo.processInfo.environment["ABSMARTLY_API_KEY"] ?? "",
        application: ProcessInfo.processInfo.environment["ABSMARTLY_APPLICATION"] ?? "",
        endpoint: ProcessInfo.processInfo.environment["ABSMARTLY_ENDPOINT"] ?? "",
        environment: ProcessInfo.processInfo.environment["ABSMARTLY_ENVIRONMENT"] ?? ""))

    let client = try DefaultClient(config: clientConfig)
    let sdkConfig = ABSmartlyConfig(client: client)
    sdk = try ABSmartlySDK(config: sdkConfig)
} catch {
    print(error.localizedDescription)
    return
}
```

</TabItem>

<TabItem value="vue" label="Vue2">

```js
import absmartly from "@absmartly/vue2-sdk";

// For commonJS, use:
// const absmartly = require('@absmartly/vue2-sdk');

// Somewhere in your application initialization code, before mounting your Vue application
Vue.use(absmartly.ABSmartlyVue, {
  sdkOptions: {
    endpoint: "https://sandbox-api.absmartly.com/v1",
    apiKey: ABSMARTLY_API_KEY,
    environment: "production",
    application: "website",
  },
  context: {
    units: {
      session_id: "5ebf06d8cb5d8137290c4abb64155584fbdb64d8",
    },
  },
  attributes: {
    user_agent: navigator.userAgent,
  },
  overrides: {
    exp_test_development: 1,
  },
});
```

</TabItem>

<TabItem value="java" label="Java">

```java
import com.absmartly.sdk.*;

public class Example {
    static public void main(String[] args) {

        final ClientConfig clientConfig = ClientConfig.create()
            .setEndpoint("https://your-company.absmartly.io/v1")
            .setAPIKey("YOUR-API-KEY")
            .setApplication("website") // created in the ABSmartly web console
            .setEnvironment("development");  // created in the ABSmartly web console

        final Client absmartlyClient = Client.create(clientConfig);

        final ABSmartlyConfig sdkConfig = ABSmartlyConfig.create()
            .setClient(absmartlyClient);


        final ABSmartly sdk = ABSmartly.create(sdkConfig);
        // ...
    }
}
```

:::caution Android 6.0 or Earlier
When targeting Android 6.0 or earlier, set the default Java Security Provider
for SSL to Conscrypt by creating the Client instance as follows:

```java
import com.absmartly.sdk.*;
import org.conscrypt.Conscrypt;

    // ...
    final ClientConfig clientConfig = ClientConfig.create()
        .setEndpoint("https://your-company.absmartly.io/v1")
        .setAPIKey("YOUR-API-KEY")
        .setApplication("website") // created in the ABSmartly web console
        .setEnvironment("development");  // created in the ABSmartly web console

    final DefaultHTTPClientConfig httpClientConfig = DefaultHTTPClientConfig.create()
        .setSecurityProvider(Conscrypt.newProvider());

    final DefaultHTTPClient httpClient = DefaultHTTPClient.create(httpClientConfig);

    final Client absmartlyClient = Client.create(clientConfig, httpClient);

    final ABSmartlyConfig sdkConfig = ABSmartlyConfig.create()
        .setClient(absmartlyClient);

    final ABSmartly sdk = ABSmartly.create(sdkConfig);
    // ...
```

:::

</TabItem>

</Tabs>

## Create a New Context Request

<Tabs groupId="language">

<TabItem value="js" label="Javascript">

**Using Raw Promises**

```js
// define a new context request
const request = {
  units: {
    userId: "123",
    session_id: "5ebf06d8cb5d8137290c4abb64155584fbdb64d8",
    email: "support@absmartly.com", // strings will be hashed
    deviceId: "345",
  },
};

const context = sdk.createContext(request);

context
  .ready()
  .then((response) => {
    console.log("ABSmartly Context ready!");
  })
  .catch((error) => {
    console.log(error);
  });
```

**Using Async/Await**

```js
// define a new context request
const request = {
  units: {
    userId: "123",
    session_id: "5ebf06d8cb5d8137290c4abb64155584fbdb64d8",
    email: "support@absmartly.com", // strings will be hashed
    deviceId: "345",
  },
};

const context = sdk.createContext(request);

try {
  await context.ready();
  console.log("ABSmartly Context ready!");
} catch (error) {
  console.log(error);
}
```

**With Pre-Fetched Data**

When doing full-stack experimentation with A/B Smartly, we recommend creating a
context only once on the server-side. Creating a context involves a round-trip
to the A/B Smartly event collector. We can avoid repeating the round-trip on
the client-side by sending the server-side data embedded in the first document,
for example, by rendering it on the template. Then we can initialize the
A/B Smartly context on the client-side directly with it.

```html
<head>
  <script type="javascript">
    const context = sdk.createContextWith({{ serverSideContext.data() }});
  </script>
</head>
```

:::info
You can use whatever you want as a unit.
You can pass an internal user id, or email address.
This could also be a cookie you generate which stores a device_id or an app's UUID. Mind that the units used have to be declared first on A/B Smartly’s Web console.

Pass all the units that are known for the current user. Some experiments may be tracked by user-id, others by device-id, etc.
You might even want to use a pageview-id for some technical experiments.

Experiments that are being tracked by a unit not being passed here, will be off in this request (the control treatment will be shown instead).
:::

</TabItem>

<TabItem value="ruby" label="Ruby">

:::info
Sorry, our Ruby documentation is not yet complete.
:::

</TabItem>

<TabItem value="swift" label="Swift">

**Creating a New Context**

```swift
let contextConfig: ContextConfig = ContextConfig()
contextConfig.setUnit(unitType: "device_id", uid: UIDevice.current.identifierForVendor!.uuidString))

let context = sdk.createContext(config: contextConfig)
context.waitUntilReady().done { context in
    print("context ready")
}
```

**Creating a New Context With Pre-Fetched Data**

When doing full-stack experimentation with A/B Smartly, we recommend creating a
context only once on the server-side. Creating a context involves a round-trip
to the A/B Smartly event collector. We can avoid repeating the round-trip on
the client-side by sending the server-side data embedded with other application
data. Then we can initialize the A/B Smartly context directly with it.

```swift
let contextConfig: ContextConfig = ContextConfig()
contextConfig.setUnit(unitType: "device_id", uid: UIDevice.current.identifierForVendor!.uuidString)

let context = sdk.createContextWithData(config: anotherContextConfig, contextData: contextData)
```

**Setting Extra Units For a Context**

You can add additional units to a context by calling the `setUnit()` or the
`setUnits()` method. This method may be used for example, when a user logs in
to your application, and you want to use the new unit type to the context.

:::info Please Note
You cannot override an already set unit type as that would
be a change of identity, and will crash your application. In this case, you
must create a new context instead. The `setUnit()` and `setUnits()` methods
can be called before the context is ready.
:::

```swift
context.setUnit(unitType: "db_user_id", uid: "1000013");
context.setUnits([
    "db_user_id": "1000013"
]);
```

</TabItem>
<TabItem value="vue" label="Vue2">

**Initializing with pre-fetched Context data**

When doing full-stack experimentation with A/B Smartly, we recommend creating
a context only once on the server-side. Creating a context involves a
round-trip to the A/B Smartly event collector. We can avoid repeating the
round-trip on the client-side by sending the server-side data embedded in the
first document, for example, by rendering it on the template. Then we can
initialize the A/B Smartly context on the client-side directly with it. The
Vue2 SDK also supports this optimized usage.

In this example, we assume the variable `prefectedContextData` contains the
pre-fetched data previously injected.

```js
// Somewhere in your application initialization code, before mounting your Vue application
Vue.use(absmartly.ABSmartlyVue, {
    sdkOptions: {
        endpoint: 'https://sandbox-api.absmartly.com/v1',
        apiKey: ABSMARTLY_API_KEY,
        environment: "production",
        application: "website"",
    },
    context: {
        units: {
            session_id: '5ebf06d8cb5d8137290c4abb64155584fbdb64d8',
        },
    },
    attributes: {
        user_agent: navigator.userAgent
    },
    data: prefetchedContext, // assuming prefectedContext has been inject
});
```

</TabItem>

<TabItem value="java" label="Java">

**Synchronously**

```java
// define a new context request
final ContextConfig contextConfig = ContextConfig.create()
    .setUnit("session_id", "5ebf06d8cb5d8137290c4abb64155584fbdb64d8"); // a unique id identifying the user

final Context context = sdk.createContext(contextConfig)
    .waitUntilReady();
```

**Asynchronously**

```java
// define a new context request
final ContextConfig contextConfig = ContextConfig.create()
    .setUnit("session_id", "5ebf06d8cb5d8137290c4abb64155584fbdb64d8"); // a unique id identifying the user

final Context context = sdk.createContext(contextConfig)
    .waitUntilReadyAsync()
    .thenAccept(ctx -> System.out.printf("context ready!"));
```

**With Pre-Fetched Data**

Creating a context involves a round-trip to the A/B Smartly event collector.
We can avoid repeating the round-trip on the client-side by re-using data
previously retrieved.

```java
final ContextConfig contextConfig = ContextConfig.create()
    .setUnit("session_id", "5ebf06d8cb5d8137290c4abb64155584fbdb64d8"); // a unique id identifying the user

final Context context = sdk.createContext(contextConfig)
    .waitUntilReady();

final ContextConfig anotherContextConfig = ContextConfig.create()
    .setUnit("session_id", "5ebf06d8cb5d8137290c4abb64155584fbdb64d8"); // a unique id identifying the other user

final Context anotherContext = sdk.createContextWith(anotherContextConfig, context.getData());

assert(anotherContext.isReady()); // no need to wait
```

**Setting extra units for a context**

You can add additional units to a context by calling the `setUnit()` or the
`setUnits()` method. This method may be used for example, when a user logs in
to your application, and you want to use the new unit type to the context.
Please note that you cannot override an already set unit type as that would
be a change of identity, and will throw an exception. In this case, you must
create a new context instead. The `setUnit()` and `setUnits()` methods can be
called before the context is ready.

```java
context.setUnit("db_user_id", "1000013");

context.setUnits(Map.of(
		"db_user_id", "1000013"
    ));
```

</TabItem>

</Tabs>

### Setting Context Attributes

<Tabs groupId="language">

<TabItem value="js" label="Javascript">

```js
// Attributes are used to pass meta-data about the user and/or the request.
// They can be used later in the web console to setup segments.

context.attribute("user_agent", navigator.userAgent);

context.attributes({
  customer_age: "new_customer",
  url: location.toString(),
  referrer: document.referrer,
  screenName: "...",
  pageName: "...",
  blockName: "...",
  country: "gb",
  language: headers["Accept-Language"],
  channel: "google-ads",
});
```

</TabItem>

<TabItem value="ruby" label="Ruby">

:::info
Sorry, our Ruby documentation is not yet complete.
:::

</TabItem>

<TabItem value="swift" label="Swift">

The `setAttribute()` and `setAttributes()` methods can be called before the
context is ready.

```swift
context.setAttribute(name: "device", value: UIDevice.current.model)
context.setAttributes(["customer_age": "new_customer", "screen": "product"])
```

</TabItem>
<TabItem value="vue" label="Vue2"></TabItem>

<TabItem value="java" label="Java"></TabItem>

</Tabs>
